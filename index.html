<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LIMIT BREAKER: NEO-EVO</title>
    
    <!-- 모바일 앱 최적화 -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#020617">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/10542/10542456.png">
    
    <!-- 라이브러리 로드 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;0,700;0,900;1,900&family=Noto+Sans+KR:wght@400;700;900&display=swap');
        body { 
            font-family: 'Inter', 'Noto Sans KR', sans-serif; 
            background-color: #020617; 
            color: white; 
            margin: 0; 
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        @keyframes pulse-glow {
            0%, 100% { opacity: 0.15; }
            50% { opacity: 0.4; }
        }
        .animate-pulse-glow { animation: pulse-glow 4s ease-in-out infinite; }
        .glass { background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        
        .calendar-cell {
            aspect-ratio: 1 / 1.35;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 4px 1px;
            position: relative;
            overflow: hidden;
        }

        .chart-container {
            width: 100%;
            height: 280px;
            position: relative;
        }

        .keep-all { word-break: keep-all; overflow-wrap: break-word; }
        .tap-scale:active { transform: scale(0.96); transition: transform 0.1s ease; }
        
        @keyframes bounce-subtle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }
        .recommend-badge { animation: bounce-subtle 2s infinite ease-in-out; }

        /* 셀렉트 박스 내부 스크롤 보장 및 스타일링 */
        select option {
            background-color: #0f172a;
            color: white;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- 컬러풀 커스텀 아이콘 ---
        const BoxingGloveIcon = ({ size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor" className={className}>
                <path d="M19,5 C16,2 12,2 9,4 C6,6 4,10 4,13 C4,14.5 4.5,16 5.5,17 L5.5,21 C5.5,22 6.5,23 7.5,23 L14.5,23 C15.5,23 16.5,22 16.5,21 L16.5,19 C18.5,18.5 20.5,17 21.5,14 C22.5,11 21,7 19,5 Z M10,13 L10,7 C10,6.5 10.5,6 11,6 C11.5,6 12,6.5 12,7 L12,13 L10,13 Z M8,13 L8,9 C8,8.5 8.5,8 9,8 C9.5,8 10,8.5 10,9 L10,13 L8,13 Z" />
            </svg>
        );

        const RingConIcon = ({ size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3.5" className={className}>
                <circle cx="12" cy="12" r="9" />
                <rect x="2" y="10" width="3" height="4" rx="1" fill="currentColor" stroke="none" />
                <rect x="19" y="10" width="3" height="4" rx="1" fill="currentColor" stroke="none" />
            </svg>
        );

        const LucideIcon = ({ name, size = 20, className = "" }) => {
            const containerRef = useRef(null);
            useEffect(() => {
                if (containerRef.current && window.lucide) {
                    containerRef.current.innerHTML = ''; 
                    const iconElement = document.createElement('i');
                    iconElement.setAttribute('data-lucide', name);
                    if (size) iconElement.style.width = `${size}px`;
                    if (size) iconElement.style.height = `${size}px`;
                    if (className) iconElement.className = className;
                    containerRef.current.appendChild(iconElement);
                    window.lucide.createIcons({ attrs: { strokeWidth: 2.5 } });
                }
            }, [name, size, className]);
            return <span ref={containerRef} className="inline-flex items-center justify-center shrink-0" />;
        };

        // --- 루틴 및 가이드 데이터 (색상 테마 스왑) ---
        const ROUTINES = [
            { id: 'day1', label: "D1", name: "하체 파워 보강", detail: "링피트 하체(15~20분) + 피박3 고강도(50분)", color: "from-blue-600 to-indigo-700", hasRingfit: true, hasBoxing: true, synergy: "하체 파워 보강: 스쿼트와 런지로 하체 근력을 먼저 소진한 뒤 복싱을 하면 하체 지지력이 좋아지고 체지방 연소가 더 빨라집니다." },
            { id: 'day2', label: "D2", name: "순수 심폐 폭격", detail: "피트니스 복싱 3 고강도(50분) 단독 수행", color: "from-orange-500 to-red-600", hasRingfit: false, hasBoxing: true, synergy: "순수 심폐 폭격: 링피트를 제외하여 관절의 피로도를 관리하면서, 50분 내내 높은 심박수를 유지해 유산소 효과를 정점으로 끌어올립니다." },
            { id: 'day3', label: "D3", name: "자세 및 밸런스", detail: "링피트 코어/등(20분) + 피박3 고강도(50분)", color: "from-cyan-400 to-blue-500", hasRingfit: true, hasBoxing: true, synergy: "자세 및 밸런스: 복싱의 웅크린 자세로 인해 굳기 쉬운 등과 어깨를 링피트로 펴주고, 코어를 잡아 펀치의 안정성을 높입니다." },
            { id: 'rest', label: "EVO", name: "초회복 (Evolution)", detail: "완전 휴식 (Recovery)", color: "from-emerald-500 to-teal-600", hasRingfit: false, hasBoxing: false, synergy: "초회복: 고강도 운동 후 근육이 재생되는 필수 시간입니다. 가벼운 산책이나 스트레칭만 권장합니다." },
            { id: 'off', label: "OFF", name: "일반 휴식", detail: "개인 사정으로 인한 정지 상태", color: "from-slate-600 to-slate-800", hasRingfit: false, hasBoxing: false, synergy: "컨디션 난조 시 에너지를 보존하고 다음 사이클을 준비하세요." },
        ];

        const CORE_GUIDES = [
            { title: "운동 순서", text: "링피트 → 복싱 순서로 반드시 진행하여 탄수화물을 먼저 소진하고 복싱에서 체지방 연소를 극대화하세요.", icon: "arrow-right-circle" },
            { title: "관절 및 피로 관리", text: "50분 고강도 복싱 부하를 고려해 링피트는 하체/코어 위주로, 3일차엔 정확한 궤적에 집중하여 부상을 예방하세요.", icon: "activity" },
            { title: "영양 및 회복", text: "운동 후 즉시 단백질 섭취로 근손실 방지, 휴식일에는 충분한 수면으로 다음 사이클을 준비하세요.", icon: "coffee" },
            { title: "링피트의 '보조' 역할", text: "복싱이 메인입니다. 링피트는 15~20분간 복싱에서 쓰지 않는 근육을 활성화하는 데 집중하세요.", icon: "target" }
        ];

        const COMPLETION_TYPES = [
            { id: 'full', label: 'FULL', component: <LucideIcon name="trophy" size={16} className="text-yellow-400" />, color: 'text-yellow-400', desc: "전체 완수" },
            { id: 'ringfit', label: 'RING', component: <RingConIcon size={16} className="text-blue-500" />, color: 'text-blue-500', desc: "링피트만" },
            { id: 'boxing', label: 'BOX', component: <BoxingGloveIcon size={16} className="text-orange-500" />, color: 'text-orange-500', desc: "복싱만" },
        ];

        // --- 300개 명언 데이터베이스 (일부만 표기, 실제 코드엔 전체 포함) ---
        const BASE_QUOTES = [
            "시작이 반이 아니라, 시작이 전부다.", "운동을 하지 않을 핑계는 1,000가지가 넘지만, 해야 할 이유는 단 하나뿐이다.", "가장 힘든 세트는 현관문을 나서는 것이다.", "어제보다 딱 1%만 더 나아가라.", "동기부여는 시작하게 만들고, 습관은 계속하게 만든다.",
            "오늘 걷지 않으면 내일은 뛰어야 한다.", "당신이 쉬고 있을 때, 누군가는 나아가고 있다.", "꾸준함이 비범함을 만든다.", "핑계는 칼로리를 태우지 못한다.", "'내일부터'라는 말은 가장 위험한 마약이다.",
            "기분이 좋지 않을 땐 운동을 해라. 기분이 좋아질 것이다.", "성공은 매일 반복되는 작은 노력의 합계다.", "습관이 몸을 만든다. 의지는 거들 뿐이다.", "천천히 가는 것을 두려워 말고, 멈추는 것을 두려워하라.", "루틴을 지키는 힘이 곧 실력이다.",
            "비가 오나 눈이 오나 체육관은 그 자리에 있다. 당신만 가면 된다.", "결심한 순간 즉시 움직여라. 뇌가 게으름을 피울 틈을 주지 마라.", "위대한 결과는 절대 편안함 속에서 나오지 않는다.", "하루를 거르면 본인이 알고, 이틀을 거르면 상대가 알고, 사흘을 거르면 관객이 안다.", "당신의 몸은 당신이 먹고 움직인 결과물이다.",
            "고통은 일시적이지만, 포기의 상처는 영원하다.", "땀은 지방이 흘리는 눈물이다.", "근육은 한계 지점에서 자라기 시작한다.", "힘들다는 것은 몸이 변하고 있다는 증거다.", "편안함은 성장의 적이다.",
            "마지막 한 개가 당신의 몸을 바꾼다.", "거울은 거짓말을 하지 않는다.", "고통을 즐겨라. 그것이 곧 당신의 훈장이다.", "강해지고 싶다면 무거워져야 한다.", "정신이 몸을 지배한다. 몸이 힘들다고 말할 때 정신은 '더 할 수 있다'고 말해야 한다.",
            "한계라고 느낄 때 비로소 운동이 시작된다.", "성공의 반대말은 실패가 아니라 포기다.", "근육통은 어제의 당신이 노력했다는 훈장이다.", "당신이 한 만큼만 얻는다. 운동은 정직한 투자다.", "편안한 길을 선택했다면 변화를 바라지 마라.",
            "한계를 넘어서는 순간, 새로운 당신이 태어난다.", "못 하겠다 말 대신 한 번 더를 외쳐라.", "강인함은 육체적인 능력에서 나오지 않는다. 굴하지 않는 의지에서 나온다.", "무거운 무게를 드는 것이 아니라, 당신의 두려움을 드는 것이다.", "승자는 한 번 더 시도한 패자다.",
            "Just Do It.", "No Pain, No Gain.", "닥치고 스쿼트(Shut up and Squat).", "강해지거나, 사라지거나.", "몸은 정직하다.",
            "포기는 배추 셀 때나 하는 말이다.", "지금 이 순간에 집중하라.", "어제보다 더 강하게.", "멈추지 마라.", "오늘의 땀, 내일의 힘.",
            "한 번 더!", "결과가 과정을 증명한다.", "핑계는 쓰레기통에.", "너 자신을 이겨라.", "땀은 배신하지 않는다.",
            "행동이 답이다.", "지치면 지는 거다.", "미쳐야 미친다(不狂不及).", "단순하게, 그리고 강하게.", "끝날 때까지 끝난 게 아니다.",
            "운동은 몸을 만드는 것이 아니라 인생을 설계하는 것이다.", "당신의 몸은 당신이 사는 유일한 집이다. 수리하며 살아라.", "남과 비교하지 마라. 어제의 당신과 비교하라.", "운동은 나 자신을 사랑하는 가장 적극적인 방법이다.", "스트레스는 근육으로 풀어라.",
            "자존감은 탄탄한 몸에서 시작된다.", "건강한 신체에 건강한 정신이 깃든다.", "운동은 사치가 아니라 생존이다.", "당신이 오늘 흘린 땀방울이 내일의 자신감을 만든다.", "힘든 운동이 인생의 힘든 순간을 버티게 해준다.",
            "나약한 태도는 나약한 사람을 만든다.", "몸이 바뀌면 인생이 바뀐다.", "1시간의 운동은 하루의 4%에 불과하다. 핑계 대지 마라.", "스스로에게 한 약속을 지키는 것이 가장 중요하다.", "외면을 가꾸면 내면도 단단해진다.",
            "가장 큰 적은 거울 속에 있다.", "운동은 벌이 아니라, 당신에게 주는 선물이다.", "지루함을 견디는 자가 승리한다.", "완벽할 필요는 없다. 그저 전보다 나아지면 된다.", "흔들리는 것은 지방이지 당신의 의지가 아니다.",
            "운동 끝나고 먹는 것까지가 운동이다.", "근육은 월세와 같다. 매일 지불하지 않으면 방을 빼야 한다.", "옷으로 가릴 생각 말고 살을 깎아라.", "맛있게 먹으면 0칼로리가 아니라, 운동하면 0칼로리다.", "하기 싫다 생각이 들 때가 바로 운동하러 갈 시간이다.",
            "오늘 쉬면 내일은 더 하기 싫다.", "무거운 건 무거운 거다. 들어라.", "야식은 내일의 당신을 울게 한다.", "거울 속에 비친 내 모습이 마음에 안 든다면, 당장 움직여라.", "청바지가 안 맞는 건 옷 잘못이 아니다.",
            "지방은 돈 주고도 못 사지만, 근육은 돈 주고도 못 산다.", "운동할 때 얼굴 망가지는 건 훈장이다.", "헬스장 전신 거울은 당신의 미래를 보여준다.", "남들이 독하다 말하면 당신은 잘하고 있는 것이다.", "샤워하고 나올 때의 그 기분만 생각해라.",
            "복근은 주방에서 만들어지고, 체육관에서 다듬어진다.", "고통은 지나가지만 섹시함은 남는다.", "내가 멈추면 내 살들이 좋아한다.", "운동은 최고의 성형이다.", "지금 바로 시작하라. 당신의 인생은 오늘부터 바뀐다."
        ];

        function App() {
            const [logs, setLogs] = useState({});
            const [viewMode, setViewMode] = useState('calendar'); 
            const [viewDate, setViewDate] = useState(new Date()); 
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [showNavModal, setShowNavModal] = useState(false);
            const [showHelp, setShowHelp] = useState(false);
            const [chartPeriod, setChartPeriod] = useState('week'); 
            const [toast, setToast] = useState(null);
            const fileInputRef = useRef(null);
            const [tempData, setTempData] = useState({ ringKcal: "", boxingKcal: "", weight: "", note: "" });

            const formatDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            const formatChartLabel = (dateStr) => {
                const date = new Date(dateStr);
                const month = date.getMonth() + 1;
                const day = date.getDate();
                const dayOfWeek = ['일', '월', '화', '수', '목', '금', '토'][date.getDay()];
                return `${month}/${day}(${dayOfWeek})`;
            };

            const todayStr = useMemo(() => formatDate(new Date()), []);
            const selectedDateStr = formatDate(selectedDate);
            const selectedLog = logs[selectedDateStr];

            useEffect(() => {
                const saved = localStorage.getItem('workout_logs_v46_stable');
                if (saved) setLogs(JSON.parse(saved));
            }, []);

            useEffect(() => {
                const log = logs[selectedDateStr] || {};
                setTempData({
                    ringKcal: log.ringKcal || "",
                    boxingKcal: log.boxingKcal || "",
                    weight: log.weight || "",
                    note: log.note || ""
                });
            }, [selectedDate, logs]);

            const showMessage = (msg) => {
                setToast(msg);
                setTimeout(() => setToast(null), 2500);
            };

            const memoLogs = useMemo(() => {
                return Object.entries(logs)
                    .filter(([_, data]) => data.note && data.note.trim() !== "")
                    .sort((a, b) => b[0].localeCompare(a[0]));
            }, [logs]);

            const currentQuote = useMemo(() => {
                const start = new Date(selectedDate.getFullYear(), 0, 0);
                const diff = (selectedDate - start) + ((start.getTimezoneOffset() - selectedDate.getTimezoneOffset()) * 60 * 1000);
                const dayOfYear = Math.floor(diff / (1000 * 60 * 60 * 24));
                return BASE_QUOTES[dayOfYear % BASE_QUOTES.length];
            }, [selectedDate]);

            // 코스 추천 알고리즘
            const recommendedRoutineId = useMemo(() => {
                const prev = new Date(selectedDate);
                prev.setDate(prev.getDate() - 1);
                const prevDateStr = formatDate(prev);
                const prevLog = logs[prevDateStr];
                if (!prevLog) return 'day1';
                switch (prevLog.programId) {
                    case 'day1': return 'day2';
                    case 'day2': return 'day3';
                    case 'day3': return 'rest';
                    case 'rest': return 'day1';
                    case 'off': return 'day1';
                    default: return 'day1';
                }
            }, [selectedDate, logs]);

            const saveLog = (dateStr, programId, status = 'full', updates = {}) => {
                const existing = logs[dateStr] || {};
                const newLogs = { 
                    ...logs, 
                    [dateStr]: { ...existing, programId: programId || existing.programId, status: status || existing.status, ...updates, updatedAt: new Date().toISOString() } 
                };
                setLogs(newLogs);
                localStorage.setItem('workout_logs_v46_stable', JSON.stringify(newLogs));
            };

            const handleManualSave = () => {
                if (!selectedLog) { showMessage("루틴을 먼저 선택하세요."); return; }
                saveLog(selectedDateStr, selectedLog.programId, selectedLog.status, tempData);
                showMessage("기록이 성공적으로 업데이트되었습니다.");
            };

            const deleteLogEntry = () => {
                const newLogs = { ...logs };
                delete newLogs[selectedDateStr];
                setLogs(newLogs);
                localStorage.setItem('workout_logs_v46_stable', JSON.stringify(newLogs));
                showMessage("기록 삭제 완료");
            };

            const exportData = () => {
                const dataStr = JSON.stringify(logs, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `limitbreaker_backup.json`;
                link.click();
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const imported = JSON.parse(e.target.result);
                        if (imported) {
                            setLogs({ ...logs, ...imported });
                            localStorage.setItem('workout_logs_v46_stable', JSON.stringify({ ...logs, ...imported }));
                            showMessage("데이터 복구 성공!");
                        }
                    } catch (err) { showMessage("오류 발생"); }
                };
                reader.readAsText(file);
            };

            // --- 데이터 기반 동적 연도 리스트 ---
            const availableYears = useMemo(() => {
                const currentYear = new Date().getFullYear();
                const years = new Set([currentYear]);
                Object.keys(logs).forEach(dateStr => years.add(new Date(dateStr).getFullYear()));
                return Array.from(years).sort((a, b) => b - a);
            }, [logs]);

            // --- 사용자 요청: 연도별 전체 주차 리스트 (일요일 시작 기준) ---
            const yearWeeks = useMemo(() => {
                const weeks = [];
                const year = viewDate.getFullYear();
                
                // 해당 연도의 첫 일요일 찾기
                let current = new Date(year, 0, 1);
                while (current.getDay() !== 0) {
                    current.setDate(current.getDate() + 1);
                }

                let weekIdx = 1;
                while (current.getFullYear() === year || (current.getFullYear() === year + 1 && current.getDate() <= 6)) {
                    if (current.getFullYear() > year && current.getDate() > 6) break;
                    
                    const monthNum = current.getMonth() + 1;
                    let firstSunOfMonth = new Date(current.getFullYear(), current.getMonth(), 1);
                    while(firstSunOfMonth.getDay() !== 0) firstSunOfMonth.setDate(firstSunOfMonth.getDate() + 1);
                    const weekOfMonth = Math.floor((current.getDate() - firstSunOfMonth.getDate()) / 7) + 1;

                    weeks.push({
                        label: `${monthNum}월 ${weekOfMonth > 0 ? weekOfMonth : 1}주차`,
                        startDate: new Date(current)
                    });
                    current.setDate(current.getDate() + 7);
                    weekIdx++;
                }
                return weeks;
            }, [viewDate]);

            // --- 계층형 차트 계산 로직 (일요일 시작 규칙 적용) ---
            const getWeekInfo = (dateStr) => {
                const d = new Date(dateStr);
                const year = d.getFullYear();
                const month = d.getMonth();
                let firstSunday = new Date(year, month, 1);
                while (firstSunday.getDay() !== 0) {
                    firstSunday.setDate(firstSunday.getDate() + 1);
                }

                if (d < firstSunday) {
                    const lastDayPrevMonth = new Date(year, month, 0);
                    return getWeekInfo(formatDate(lastDayPrevMonth));
                }

                const diffDays = Math.floor((d - firstSunday) / (24 * 60 * 60 * 1000));
                const weekNum = Math.floor(diffDays / 7) + 1;
                return { year, month: month + 1, week: weekNum };
            };

            const chartAnalytics = useMemo(() => {
                const sortedDates = Object.keys(logs).sort();
                let aggregated = {};
                let subTitle = "";
                let totalKcal = 0;

                if (chartPeriod === 'week') {
                    const startOfWeek = new Date(viewDate);
                    startOfWeek.setDate(viewDate.getDate() - viewDate.getDay());
                    for (let i = 0; i < 7; i++) {
                        const d = new Date(startOfWeek);
                        d.setDate(startOfWeek.getDate() + i);
                        const dStr = formatDate(d);
                        aggregated[dStr] = { ring: 0, box: 0, weights: [], label: formatChartLabel(dStr) };
                    }
                    const info = getWeekInfo(formatDate(startOfWeek));
                    subTitle = `${info.month}월 ${info.week}주차`;
                } else if (chartPeriod === 'month') {
                    subTitle = `${viewDate.getMonth() + 1}월`;
                } else if (chartPeriod === 'year') {
                    subTitle = `${viewDate.getFullYear()}년`;
                }

                sortedDates.forEach(dateStr => {
                    const log = logs[dateStr];
                    const dateObj = new Date(dateStr);
                    let key = "";
                    let displayLabel = "";

                    if (chartPeriod === 'week') {
                        if (aggregated[dateStr]) key = dateStr;
                    } else if (chartPeriod === 'month') {
                        if (dateObj.getMonth() === viewDate.getMonth() && dateObj.getFullYear() === viewDate.getFullYear()) {
                            const info = getWeekInfo(dateStr);
                            key = `W${info.week}`;
                            displayLabel = `${info.week}주`;
                        }
                    } else if (chartPeriod === 'year') {
                        if (dateObj.getFullYear() === viewDate.getFullYear()) {
                            const monthNum = dateObj.getMonth() + 1;
                            key = `M${monthNum}`;
                            displayLabel = `${monthNum}월`;
                        }
                    }

                    if (key) {
                        if (!aggregated[key]) aggregated[key] = { ring: 0, box: 0, weights: [], label: displayLabel };
                        const ring = parseFloat(log.ringKcal) || 0;
                        const box = parseFloat(log.boxingKcal) || 0;
                        aggregated[key].ring += ring;
                        aggregated[key].box += box;
                        totalKcal += (ring + box);
                        if (log.weight) aggregated[key].weights.push(parseFloat(log.weight));
                    }
                });

                const items = Object.values(aggregated).map(item => ({
                    ...item,
                    total: item.ring + item.box,
                    weight: item.weights.length > 0 ? (item.weights.reduce((a, b) => a + b, 0) / item.weights.length).toFixed(1) : null
                }));

                return { items, subTitle, totalKcal };
            }, [logs, chartPeriod, viewDate]);

            // --- 차트 렌더링 (색상 스왑 반영: Ring=Blue, Box=Orange) ---
            const BarChart = ({ data }) => {
                const width = 300, height = 150;
                if (data.length === 0) return <div className="h-full flex items-center justify-center opacity-30 text-xs italic">데이터가 없습니다.</div>;
                const maxKcal = Math.max(...data.map(d => d.total), 500);
                const barWidth = Math.min((width / data.length) * 0.7, 45);
                return (
                    <svg viewBox={`0 0 ${width} ${height + 50}`} className="w-full h-full overflow-visible">
                        {data.map((d, i) => {
                            const x = (data.length > 1) ? (i / (data.length - 1)) * (width - barWidth) : (width - barWidth) / 2;
                            const rH = (d.ring / maxKcal) * height, bH = (d.box / maxKcal) * height;
                            return (
                                <g key={i}>
                                    {/* 링피트 (블루 계열) */}
                                    <rect x={x} y={height - rH} width={barWidth} height={rH} fill="#3b82f6" rx="2" />
                                    {/* 복싱 (오렌지/레드 계열) */}
                                    <rect x={x} y={height - rH - bH} width={barWidth} height={bH} fill="#f97316" rx="2" />
                                    <text x={x + barWidth/2} y={height + 25} textAnchor="middle" fontSize="9" fill="#64748b" fontWeight="bold">{d.label}</text>
                                    {d.total > 0 && <text x={x + barWidth/2} y={height - rH - bH - 12} textAnchor="middle" fontSize="11" fontWeight="900" fill="#22d3ee">{Math.round(d.total)}</text>}
                                    {d.box > 40 && <text x={x + barWidth/2} y={height - rH - bH + (bH/2) + 4} textAnchor="middle" fontSize="8" fontWeight="900" fill="#fff">{Math.round(d.box)}</text>}
                                    {d.ring > 40 && <text x={x + barWidth/2} y={height - (rH/2) + 4} textAnchor="middle" fontSize="8" fontWeight="900" fill="#fff">{Math.round(d.ring)}</text>}
                                </g>
                            );
                        })}
                    </svg>
                );
            };

            const LineChart = ({ data }) => {
                const width = 300, height = 120;
                const valid = data.filter(d => d.weight !== null);
                if (valid.length < 1) return <div className="h-full flex items-center justify-center opacity-30 text-xs italic">기록 없음</div>;
                const values = valid.map(d => parseFloat(d.weight));
                const min = Math.min(...values) - 0.5, max = Math.max(...values) + 0.5, range = max - min || 1;
                const points = valid.map((d, i) => ({
                    x: valid.length > 1 ? (i / (valid.length - 1)) * width : width / 2,
                    y: height - ((parseFloat(d.weight) - min) / range) * height,
                    val: d.weight, label: d.label
                }));
                return (
                    <svg viewBox={`0 0 ${width} ${height + 50}`} className="w-full h-full overflow-visible">
                        {points.length > 1 && <polyline points={points.map(p => `${p.x},${p.y}`).join(' ')} fill="none" stroke="#22d3ee" strokeWidth="4" strokeLinecap="round" strokeLinejoin="round" />}
                        {points.map((p, i) => (
                            <g key={i}>
                                <circle cx={p.x} cy={p.y} r="5" fill="#fff" stroke="#22d3ee" strokeWidth="2" />
                                <text x={p.x} y={p.y - 12} textAnchor="middle" fontSize="13" fontWeight="900" fill="#22d3ee" className="drop-shadow-sm">{p.val}</text>
                                <text x={p.x} y={height + 30} textAnchor="middle" fontSize="9" fontWeight="700" fill="#64748b">{p.label}</text>
                            </g>
                        ))}
                    </svg>
                );
            };

            const calendarDays = useMemo(() => {
                const first = new Date(viewDate.getFullYear(), viewDate.getMonth(), 1).getDay();
                const last = new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 0).getDate();
                const days = [];
                for (let i = 0; i < first; i++) days.push(null);
                for (let i = 1; i <= last; i++) days.push(new Date(viewDate.getFullYear(), viewDate.getMonth(), i));
                return days;
            }, [viewDate]);

            return (
                <div className="min-h-screen text-slate-100 pb-40 overflow-x-hidden selection:bg-cyan-500/30">
                    <div className="fixed inset-0 pointer-events-none -z-10 overflow-hidden">
                        <div className="absolute top-[-5%] right-[-5%] w-[80%] h-[80%] bg-blue-600/10 blur-[150px] animate-pulse-glow rounded-full"></div>
                        <div className="absolute bottom-[-5%] left-[-5%] w-[80%] h-[80%] bg-indigo-600/10 blur-[150px] animate-pulse-glow rounded-full"></div>
                    </div>

                    <div className="w-full max-w-4xl mx-auto px-4 pt-6 md:pt-10 text-center">
                        <header className="flex justify-between items-center mb-8 px-1 text-left">
                            <div className="shrink">
                                <h1 className="text-3xl sm:text-5xl font-black italic tracking-tighter leading-none text-white uppercase keep-all">Limit <span className="text-cyan-400">Breaker</span></h1>
                                <p className="text-[10px] font-black tracking-widest text-slate-500 uppercase mt-1">NEO-EVO System</p>
                            </div>
                            <div className="glass p-3 rounded-[1.5rem] text-right min-w-[110px] shadow-lg relative border-white/5">
                                <button onClick={() => setShowHelp(true)} className="absolute -left-2 -top-2 w-7 h-7 bg-white/10 rounded-full flex items-center justify-center border border-white/5 active:scale-90 shadow-md"><LucideIcon name="info" size={14} /></button>
                                <div className="text-xl sm:text-2xl font-black italic leading-none">{Object.keys(logs).filter(d => d.startsWith(viewDate.getFullYear().toString()) && logs[d].programId !== 'off').length} <span className="text-slate-600 text-[10px] font-normal italic">/ 300</span></div>
                                <div className="mt-2 h-1.5 w-full bg-slate-900 rounded-full overflow-hidden border border-white/5 shadow-inner">
                                    <div className="h-full bg-cyan-400 shadow-[0_0_10px_#22d3ee] transition-all duration-1000" style={{width: `${Math.min((Object.keys(logs).length/300)*100, 100)}%`}}></div>
                                </div>
                            </div>
                        </header>

                        <main className="mb-10 text-center">
                            {viewMode === 'calendar' && (
                                <div className="flex flex-col gap-5 animate-in fade-in duration-500">
                                    <div className="glass rounded-[2.2rem] p-4 sm:p-8 shadow-2xl border-white/5 text-center">
                                        <div className="flex justify-between items-center mb-6">
                                            <button onClick={() => setShowNavModal(true)} className="flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-base sm:text-2xl font-black italic hover:border-cyan-400/50 transition-all">
                                                {viewDate.getFullYear()} <span className="text-cyan-400">{viewDate.getMonth() + 1}월</span>
                                                <LucideIcon name="search" size={14} className="text-slate-500" />
                                            </button>
                                            <div className="flex gap-2 bg-black/40 p-1 rounded-xl border border-white/5 shadow-inner">
                                                <button onClick={() => setViewDate(new Date(viewDate.setMonth(viewDate.getMonth() - 1)))} className="p-2 hover:bg-white/10 rounded-lg transition-all"><LucideIcon name="chevron-left" size={18}/></button>
                                                <button onClick={() => setViewDate(new Date(viewDate.setMonth(viewDate.getMonth() + 1)))} className="p-2 hover:bg-white/10 rounded-lg transition-all"><LucideIcon name="chevron-right" size={18}/></button>
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-7 gap-1 sm:gap-3 text-center mb-3">
                                            {['일','월','화','수','목','금','토'].map((d, i) => (
                                                <div key={i} className={`text-[12px] font-black ${i===0?'text-red-500':i===6?'text-blue-500':'text-slate-500'} opacity-70 mb-1`}>{d}</div>
                                            ))}
                                            {calendarDays.map((date, i) => {
                                                if (!date) return <div key={`empty-${i}`} className="aspect-square opacity-0"></div>;
                                                const dStr = formatDate(date);
                                                const log = logs[dStr];
                                                const routine = log ? ROUTINES.find(r => r.id === log.programId) : null;
                                                const completion = log ? COMPLETION_TYPES.find(t => t.id === log.status) : null;
                                                const isActive = selectedDateStr === dStr;
                                                const isTodayLocal = todayStr === dStr;

                                                return (
                                                    <button key={dStr} onClick={() => setSelectedDate(date)} 
                                                        className={`calendar-cell rounded-[1rem] sm:rounded-[1.5rem] transition-all duration-300 border-2 
                                                        ${isActive ? 'bg-cyan-500 border-white shadow-xl scale-110 z-10' : 'bg-white/5 border-transparent hover:bg-white/10'} 
                                                        ${isTodayLocal && !isActive ? 'border-cyan-400 shadow-[0_0_15px_rgba(34,211,238,0.4)]' : ''}`}>
                                                        <span className={`text-base sm:text-3xl font-black leading-none mt-1 ${isActive ? 'text-white' : isTodayLocal ? 'text-cyan-400 underline underline-offset-4 decoration-2' : 'text-slate-400'}`}>{date.getDate()}</span>
                                                        <div className="flex flex-col items-center gap-1 w-full pb-1 mt-auto">
                                                            {log && routine && (
                                                                <div className="scale-90 transition-transform drop-shadow-sm">
                                                                    {routine.id === 'rest' ? <LucideIcon name="sparkles" size={12} className="text-emerald-400" /> : routine.id === 'off' ? <LucideIcon name="moon" size={12} className="text-slate-400" /> : completion?.component}
                                                                </div>
                                                            )}
                                                            {log && routine && <div className={`w-[95%] rounded-full text-[7px] font-black text-center truncate px-0.5 uppercase ${isActive ? 'bg-white text-cyan-600 shadow-sm' : 'bg-slate-800 text-white opacity-80'}`}>{routine.label}</div>}
                                                        </div>
                                                    </button>
                                                );
                                            })}
                                        </div>
                                        <div className="flex justify-center flex-wrap gap-x-4 gap-y-2 pt-4 border-t border-white/5 opacity-70 text-center">
                                            {COMPLETION_TYPES.map(t => (
                                                <div key={t.id} className="flex items-center gap-1.5">{t.component}<span className="text-[9px] font-bold uppercase">{t.label}</span></div>
                                            ))}
                                            <div className="flex items-center gap-1.5"><LucideIcon name="sparkles" size={10} className="text-emerald-400" /><span className="text-[9px] font-bold uppercase">EVO</span></div>
                                            <div className="flex items-center gap-1.5"><LucideIcon name="moon" size={10} className="text-slate-400" /><span className="text-[9px] font-bold uppercase">OFF</span></div>
                                        </div>
                                    </div>

                                    <div className="glass rounded-[1.8rem] p-6 relative overflow-hidden text-center border-white/5 shadow-xl">
                                        <div className="absolute top-[-10px] left-[-10px] opacity-[0.05] text-cyan-400"><LucideIcon name="quote" size={100} /></div>
                                        <p className="text-[10px] font-black text-cyan-500 uppercase tracking-[0.4em] mb-2 opacity-80">Today's Pulse</p>
                                        <p className="text-lg sm:text-2xl font-black italic text-slate-100 leading-snug relative z-10 px-4 keep-all drop-shadow-md">"{currentQuote}"</p>
                                    </div>

                                    <div className="glass rounded-[2.5rem] overflow-hidden shadow-2xl flex flex-col mb-4 border-white/5 text-left text-keep-all">
                                        <div className={`p-6 bg-gradient-to-br ${selectedLog ? ROUTINES.find(r => r.id === selectedLog.programId)?.color : 'from-slate-800 to-slate-900'} transition-all duration-1000 relative border-b border-white/5 shadow-lg`}>
                                            <p className="text-white/60 text-[11px] font-black mb-1 uppercase tracking-widest opacity-90">{selectedDate.toLocaleDateString('ko-KR', { month: 'long', day: 'numeric', weekday: 'long' })}</p>
                                            <h2 className="text-2xl sm:text-4xl font-black text-white italic tracking-tighter uppercase leading-tight">{selectedLog ? ROUTINES.find(r => r.id === selectedLog.programId)?.name : "Combat Briefing"}</h2>
                                            {selectedLog && <button onClick={deleteLogEntry} className="absolute top-8 right-8 p-3 bg-black/20 rounded-full text-red-400 border border-white/5 tap-scale shadow-md hover:bg-red-500/20 transition-all"><LucideIcon name="trash-2" size={20} /></button>}
                                        </div>
                                        <div className="p-6 space-y-10">
                                            <section>
                                                <h3 className="text-[13px] font-black text-slate-500 uppercase tracking-widest border-l-4 border-cyan-400 pl-4 mb-6 flex items-center justify-between">Routine Select <span className="text-[9px] font-bold text-cyan-500 italic uppercase">Mission Command</span></h3>
                                                <div className="grid grid-cols-2 gap-4">
                                                    {ROUTINES.map(r => {
                                                        const isRecommended = r.id === recommendedRoutineId;
                                                        return (
                                                            <button key={r.id} onClick={() => saveLog(selectedDateStr, r.id, (r.id === 'rest' || r.id === 'off') ? 'full' : (selectedLog?.status || 'full'))} 
                                                                className={`p-4 rounded-[1.8rem] text-left border-2 transition-all tap-scale relative overflow-hidden 
                                                                ${selectedLog?.programId === r.id ? 'border-cyan-400 bg-cyan-400/10 shadow-lg scale-[1.02]' : 'border-white/5 bg-white/5 hover:border-white/20'}
                                                                ${isRecommended && !selectedLog ? 'ring-2 ring-cyan-500/50' : ''}`}>
                                                                {isRecommended && !selectedLog && (
                                                                    <div className="absolute top-0 right-0 bg-cyan-500 text-slate-950 text-[7px] font-black px-2 py-0.5 rounded-bl-lg recommend-badge tracking-tighter uppercase">Recommended</div>
                                                                )}
                                                                <p className={`text-[12px] font-black mb-1 ${selectedLog?.programId === r.id ? 'text-cyan-400' : 'text-slate-500'}`}>{r.label}</p>
                                                                <p className="text-sm font-black text-white uppercase truncate tracking-tight">{r.name}</p>
                                                            </button>
                                                        );
                                                    })}
                                                </div>
                                            </section>

                                            {selectedLog && (
                                                <div className="animate-in slide-in-from-top-4 duration-500 space-y-12">
                                                    {selectedLog.programId !== 'rest' && selectedLog.programId !== 'off' && (
                                                        <section>
                                                            <h3 className="text-[13px] font-black text-slate-500 uppercase tracking-widest border-l-4 border-cyan-400 pl-4 mb-6">Completion Status</h3>
                                                            <div className="grid grid-cols-3 gap-4">
                                                                {COMPLETION_TYPES.map(t => (
                                                                    <button key={t.id} onClick={() => saveLog(selectedDateStr, selectedLog.programId, t.id)} className={`flex flex-col items-center justify-center p-6 rounded-[1.8rem] border-2 transition-all tap-scale ${selectedLog.status === t.id ? 'bg-white text-slate-950 border-white shadow-2xl scale-105' : 'border-white/5 text-slate-500 hover:border-white/10'}`}>
                                                                        <div className="mb-2 scale-150">{t.component}</div>
                                                                        <span className="text-[11px] font-black uppercase tracking-widest">{t.label}</span>
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        </section>
                                                    )}

                                                    <section className="space-y-6">
                                                        <h3 className="text-[13px] font-black text-slate-500 uppercase tracking-widest border-l-4 border-cyan-400 pl-4 flex items-center justify-between">Performance Stats {selectedLog.updatedAt && <span className="text-[9px] font-medium opacity-40 uppercase tracking-tighter">Sync: {new Date(selectedLog.updatedAt).toLocaleTimeString()}</span>}</h3>
                                                        <div className="grid grid-cols-2 gap-5">
                                                            <div className="space-y-2 relative group">
                                                                <label className="text-[11px] font-black text-slate-500 uppercase ml-1 flex justify-between">Weight <button onClick={()=>setTempData(p=>({...p, weight:""}))} className="text-slate-700 hover:text-red-400"><LucideIcon name="x-circle" size={14}/></button></label>
                                                                <input type="number" step="0.1" value={tempData.weight} onChange={(e) => setTempData({...tempData, weight: e.target.value})} placeholder="00.0" className="w-full bg-white/5 border border-white/10 rounded-[1.2rem] p-4 text-xl font-black text-white focus:outline-none focus:ring-2 ring-cyan-400 shadow-inner placeholder:opacity-20" />
                                                            </div>
                                                            <div className="space-y-4">
                                                                {ROUTINES.find(r => r.id === selectedLog.programId)?.hasRingfit && (
                                                                    <div className="space-y-1 relative group">
                                                                        <label className="text-[10px] font-black text-blue-500 uppercase ml-1 flex justify-between">RingFit <button onClick={()=>setTempData(p=>({...p, ringKcal:""}))} className="text-slate-700 hover:text-red-400"><LucideIcon name="x-circle" size={14}/></button></label>
                                                                        <input type="number" value={tempData.ringKcal} onChange={(e) => setTempData({...tempData, ringKcal: e.target.value})} placeholder="kcal" className="w-full bg-white/5 border border-white/10 rounded-[1.2rem] p-4 text-lg font-black text-blue-400 focus:outline-none focus:ring-2 ring-blue-500 shadow-inner placeholder:opacity-20" />
                                                                    </div>
                                                                )}
                                                                {ROUTINES.find(r => r.id === selectedLog.programId)?.hasBoxing && (
                                                                    <div className="space-y-1 relative group">
                                                                        <label className="text-[10px] font-black text-orange-500 uppercase ml-1 flex justify-between">Boxing <button onClick={()=>setTempData(p=>({...p, boxingKcal:""}))} className="text-slate-700 hover:text-red-400"><LucideIcon name="x-circle" size={14}/></button></label>
                                                                        <input type="number" value={tempData.boxingKcal} onChange={(e) => setTempData({...tempData, boxingKcal: e.target.value})} placeholder="kcal" className="w-full bg-white/5 border border-white/10 rounded-[1.2rem] p-4 text-lg font-black text-orange-400 focus:outline-none focus:ring-2 ring-orange-500 shadow-inner placeholder:opacity-20" />
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                        <div className="space-y-4 pt-4 border-t border-white/5">
                                                            <h3 className="text-[14px] font-black text-slate-500 uppercase tracking-widest border-l-4 border-cyan-400 pl-4 flex justify-between">Combat Memo <button onClick={()=>setTempData(p=>({...p, note:""}))} className="text-slate-700 hover:text-red-400"><LucideIcon name="refresh-cw" size={18}/></button></h3>
                                                            <textarea value={tempData.note} onChange={(e) => setTempData({...tempData, note: e.target.value})} placeholder="훈련 기록이나 수정을 진행하세요..." className="w-full bg-white/5 border border-white/10 rounded-[1.8rem] p-6 text-lg text-slate-200 placeholder:text-slate-700 focus:outline-none focus:ring-2 ring-cyan-400 min-h-[160px] resize-none leading-relaxed shadow-inner" />
                                                            <button onClick={handleManualSave} className="w-full py-6 bg-cyan-600 hover:bg-cyan-500 rounded-[2rem] font-black text-lg uppercase shadow-2xl tap-scale transition-all flex items-center justify-center gap-4 border border-white/10 shadow-lg">
                                                                <LucideIcon name="save" size={24} /> Sync Performance
                                                            </button>
                                                        </div>
                                                    </section>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {viewMode === 'chart' && (
                                <div className="flex flex-col gap-6 animate-in slide-in-from-bottom-4 duration-500 pb-12">
                                    <div className="flex flex-col gap-4 px-1 text-left">
                                        <h3 className="text-xl font-black text-cyan-400 uppercase tracking-[0.2em] flex items-center gap-3"><LucideIcon name="trending-up" size={28}/> Performance</h3>
                                        
                                        {/* 주간/월간/연간 토글 버튼 (최적화 위치) */}
                                        <div className="flex bg-white/5 rounded-full p-1.5 border border-white/10 shadow-inner w-fit">
                                            {['week', 'month', 'year'].map(p => (
                                                <button key={p} onClick={() => setChartPeriod(p)} className={`px-5 py-2 rounded-full text-[11px] font-black transition-all uppercase ${chartPeriod === p ? 'bg-cyan-500 text-white shadow-xl' : 'text-slate-500 hover:text-white'}`}>
                                                    {p === 'week' ? 'Weekly' : p === 'month' ? 'Monthly' : 'Yearly'}
                                                </button>
                                            ))}
                                        </div>

                                        <div className="flex gap-2 w-full">
                                            {chartPeriod === 'week' && (
                                                <select 
                                                    value={formatDate(new Date(viewDate.setDate(viewDate.getDate() - viewDate.getDay())))} 
                                                    onChange={(e) => setViewDate(new Date(e.target.value))}
                                                    className="flex-1 glass border-white/10 rounded-xl p-3 text-sm font-bold appearance-none outline-none focus:ring-1 ring-cyan-400"
                                                >
                                                    {yearWeeks.map((w, idx) => (
                                                        <option key={idx} value={formatDate(w.startDate)}>{w.label}</option>
                                                    ))}
                                                </select>
                                            )}
                                            {chartPeriod === 'month' && (
                                                <select 
                                                    value={viewDate.getMonth()} 
                                                    onChange={(e) => setViewDate(new Date(viewDate.getFullYear(), parseInt(e.target.value), 1))}
                                                    className="flex-1 glass border-white/10 rounded-xl p-3 text-sm font-bold appearance-none outline-none focus:ring-1 ring-cyan-400"
                                                >
                                                    {Array.from({length: 12}).map((_, i) => (
                                                        <option key={i} value={i}>{i + 1}월</option>
                                                    ))}
                                                </select>
                                            )}
                                            {(chartPeriod === 'month' || chartPeriod === 'year') && (
                                                <select 
                                                    value={viewDate.getFullYear()} 
                                                    onChange={(e) => setViewDate(new Date(parseInt(e.target.value), viewDate.getMonth(), 1))}
                                                    className="flex-1 glass border-white/10 rounded-xl p-3 text-sm font-bold appearance-none outline-none focus:ring-1 ring-cyan-400"
                                                >
                                                    {availableYears.map(y => <option key={y} value={y}>{y}년</option>)}
                                                </select>
                                            )}
                                        </div>
                                    </div>

                                    <div className="glass rounded-[2.5rem] p-8 border-white/5 shadow-xl flex flex-col items-center">
                                        <div className="flex justify-between items-center mb-10 text-center flex-col gap-2">
                                            <h4 className="text-xl font-black text-white uppercase tracking-tight italic">Calories Burnt (kcal)</h4>
                                            <div className="text-sm font-black text-cyan-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                                                {chartAnalytics.subTitle} 
                                                <span className="text-[10px] text-white/50 lowercase italic">
                                                    (Total: {Math.round(chartAnalytics.totalKcal).toLocaleString()} kcal)
                                                </span>
                                            </div>
                                            <div className="flex gap-5 justify-center">
                                                {/* 색상 스왑 반영 */}
                                                <div className="flex items-center gap-2 text-[10px] font-black text-blue-500 uppercase tracking-widest"><div className="w-3 h-3 rounded-full bg-blue-500 shadow-[0_0_8px_#3b82f6]"></div> RF</div>
                                                <div className="flex items-center gap-2 text-[10px] font-black text-orange-500 uppercase tracking-widest"><div className="w-3 h-3 rounded-full bg-orange-500 shadow-[0_0_8px_#f97316]"></div> BX</div>
                                            </div>
                                        </div>
                                        <div className="chart-container mb-10"><BarChart data={chartAnalytics.items} /></div>
                                    </div>

                                    <div className="glass rounded-[2.5rem] p-8 border-white/5 shadow-xl text-center">
                                        <h4 className="text-xl font-black text-white uppercase tracking-tight mb-2 italic">Average Weight (kg)</h4>
                                        <div className="text-xs font-black text-cyan-400/60 uppercase tracking-widest mb-8">{chartAnalytics.subTitle}</div>
                                        <div className="chart-container"><LineChart data={chartAnalytics.items} /></div>
                                    </div>
                                </div>
                            )}

                            {viewMode === 'memo' && (
                                <div className="flex flex-col gap-6 animate-in slide-in-from-bottom-4 duration-500 text-left">
                                    <h3 className="text-2xl font-black text-cyan-400 uppercase tracking-[0.3em] px-1 flex items-center gap-4 mb-4"><LucideIcon name="message-square" size={32}/> Archives</h3>
                                    {memoLogs.length === 0 ? <div className="glass rounded-[3rem] p-24 text-center opacity-30 italic text-2xl border-dashed border-2 border-white/10 text-slate-400">기록된 소감이 없습니다.</div> : memoLogs.map(([date, data]) => {
                                        const routine = ROUTINES.find(r => r.id === data.programId) || ROUTINES[4];
                                        return (
                                            <div key={date} className="glass rounded-[3rem] overflow-hidden shadow-2xl border-white/5 group mb-6 hover:scale-[1.01] transition-all">
                                                <div className={`px-10 py-6 bg-gradient-to-r ${routine?.color} flex justify-between items-center shadow-lg`}>
                                                    <span className="text-lg font-black italic tracking-widest text-white/90 uppercase">{formatChartLabel(date)}</span>
                                                    <div className="flex items-center gap-4 text-white">
                                                        <LucideIcon name={routine?.id === 'rest' ? 'sparkles' : (routine?.id === 'off' ? 'moon' : 'award')} size={24} />
                                                        <span className="text-[14px] font-black opacity-90 uppercase tracking-widest">{routine?.label} SUCCESS</span>
                                                    </div>
                                                </div>
                                                <div className="p-10 space-y-6 text-left text-keep-all">
                                                    <div className="flex gap-8 items-start">
                                                        <div className="text-cyan-400 opacity-20 shrink-0 mt-1"><LucideIcon name="quote" size={50} /></div>
                                                        <p className="text-xl sm:text-2xl text-slate-100 font-medium leading-relaxed italic py-2 drop-shadow-sm keep-all font-bold">"{data.note}"</p>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}

                            {viewMode === 'program' && (
                                <div className="flex flex-col gap-8 animate-in slide-in-from-bottom-4 duration-500 pb-20 text-left text-keep-all">
                                    <h3 className="text-2xl font-black text-cyan-400 uppercase tracking-[0.3em] px-1 flex items-center gap-4 mb-4"><LucideIcon name="layout-grid" size={32}/> Hybrid Database</h3>
                                    <div className="grid grid-cols-1 gap-6">
                                        {ROUTINES.map(r => (
                                            <div key={r.id} className="glass rounded-[3.5rem] overflow-hidden shadow-2xl border-white/5 group hover:border-cyan-400/50 transition-all border border-white/5 text-left">
                                                <div className={`bg-gradient-to-br ${r.color} p-10 flex justify-between items-center shadow-lg`}>
                                                    <span className="font-black text-3xl text-white italic uppercase drop-shadow-lg tracking-tight">{r.label} - {r.name}</span>
                                                    <LucideIcon name={r.id === 'rest' ? "sparkles" : r.id === 'off' ? "moon" : "flame"} size={40} className="text-white shadow-md" />
                                                </div>
                                                <div className="p-10 space-y-8 text-left">
                                                    <div className="space-y-2">
                                                        <h4 className="text-xs font-black text-white/50 uppercase tracking-[0.3em]">Program Structure</h4>
                                                        <p className="text-slate-100 text-2xl font-bold tracking-tight leading-snug keep-all font-black uppercase italic tracking-tighter">{r.detail}</p>
                                                    </div>
                                                    <div className="space-y-4 pt-6 border-t border-white/5 text-left">
                                                        <h4 className="text-xs font-black text-cyan-400 uppercase tracking-[0.3em] flex items-center gap-2"><LucideIcon name="zap" size={14}/> Synergy Boost</h4>
                                                        <p className="text-lg text-slate-300 font-medium italic opacity-90 leading-relaxed keep-all font-medium">"{r.synergy}"</p>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="space-y-8 mt-12 px-2 text-left">
                                        <h3 className="text-xl font-black text-white italic uppercase border-b-2 border-cyan-400 pb-4 inline-block text-left">Combat Core Guides</h3>
                                        <div className="grid grid-cols-1 gap-4">
                                            {CORE_GUIDES.map((g, idx) => (
                                                <div key={idx} className="glass p-8 rounded-[2.5rem] flex gap-6 items-start border-white/5 hover:bg-white/[0.03] transition-all text-left">
                                                    <div className="bg-cyan-500/10 p-4 rounded-3xl text-cyan-400 shrink-0"><LucideIcon name={g.icon} size={28}/></div>
                                                    <div className="space-y-2 text-left">
                                                        <h4 className="text-xl font-black text-white italic">{idx + 1}. {g.title}</h4>
                                                        <p className="text-base text-slate-400 font-medium leading-relaxed keep-all">{g.text}</p>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="glass rounded-[3.5rem] p-12 border-cyan-400/20 shadow-2xl mb-12 text-center mt-10">
                                        <h3 className="text-base font-black text-cyan-400 uppercase tracking-widest mb-10 flex items-center justify-center gap-4"><LucideIcon name="database" size={32} /> System Management</h3>
                                        <div className="grid grid-cols-1 gap-6 px-4 text-center">
                                            <button onClick={exportData} className="flex items-center justify-center gap-5 bg-cyan-600 hover:bg-cyan-500 text-white font-black py-8 rounded-[2.5rem] text-xl uppercase transition-all shadow-2xl active:scale-95 transition-all shadow-lg"><LucideIcon name="download" size={32} /> Backup DB (.json)</button>
                                            <button onClick={() => fileInputRef.current.click()} className="flex items-center justify-center gap-5 bg-white/10 hover:bg-white/20 text-white font-black py-8 rounded-[2.5rem] text-xl uppercase transition-all border border-white/5 shadow-2xl"><LucideIcon name="upload" size={32} /> Restore DB File</button>
                                            <input type="file" ref={fileInputRef} onChange={importData} accept=".json" className="hidden" />
                                        </div>
                                    </div>
                                </div>
                            )}
                        </main>

                        {/* 하단 네비게이션: 최적화 높이 */}
                        <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 w-[94%] max-w-lg glass rounded-[2.5rem] p-2 flex gap-1.5 shadow-[0_30px_60px_rgba(0,0,0,0.8)] z-50 border-white/20 no-scrollbar overflow-x-auto text-left">
                            <button onClick={() => setViewMode('calendar')} className={`flex-1 flex flex-col items-center justify-center gap-1 py-3.5 rounded-[2rem] text-[11px] font-black transition-all uppercase tracking-widest ${viewMode === 'calendar' ? 'bg-white text-slate-950 shadow-xl' : 'text-slate-500 hover:text-white'}`}><LucideIcon name="calendar" size={20} /> CAL</button>
                            <button onClick={() => setViewMode('memo')} className={`flex-1 flex flex-col items-center justify-center gap-1 py-3.5 rounded-[2rem] text-[11px] font-black transition-all uppercase tracking-widest ${viewMode === 'memo' ? 'bg-white text-slate-950 shadow-xl' : 'text-slate-500 hover:text-white'}`}><LucideIcon name="message-square" size={20} /> MEMO</button>
                            <button onClick={() => setViewMode('chart')} className={`flex-1 flex flex-col items-center justify-center gap-1 py-3.5 rounded-[2rem] text-[11px] font-black transition-all uppercase tracking-widest ${viewMode === 'chart' ? 'bg-white text-slate-950 shadow-xl' : 'text-slate-500 hover:text-white'}`}><LucideIcon name="trending-up" size={20} /> CHART</button>
                            <button onClick={() => setViewMode('program')} className={`flex-1 flex flex-col items-center justify-center gap-1 py-3.5 rounded-[2rem] text-[11px] font-black transition-all uppercase tracking-widest ${viewMode === 'program' ? 'bg-white text-slate-950 shadow-xl' : 'text-slate-500 hover:text-white'}`}><LucideIcon name="layout-grid" size={20} /> DB</button>
                        </nav>
                    </div>

                    {toast && <div className="fixed bottom-44 left-1/2 -translate-x-1/2 z-[200] glass px-12 py-8 rounded-full shadow-[0_40px_80px_rgba(0,0,0,0.9)] border-cyan-400/60 animate-in fade-in slide-in-from-bottom-12 transition-all shadow-xl text-center"><p className="text-xl font-black text-cyan-400 tracking-tight flex items-center gap-5 justify-center text-center"><LucideIcon name="check-circle" size={30} /> {toast}</p></div>}

                    {showNavModal && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 backdrop-blur-3xl bg-black/85 animate-in fade-in duration-300">
                            <div className="glass border-white/20 rounded-[4rem] p-12 w-full max-md shadow-2xl">
                                <div className="flex justify-between items-center mb-10 text-cyan-400 font-black italic uppercase tracking-widest text-3xl text-center w-full">Warp Drive<button onClick={() => setShowNavModal(false)} className="p-4 bg-white/5 rounded-full border border-white/5 hover:bg-red-500/20 transition-all text-center"><LucideIcon name="x" size={32} /></button></div>
                                <div className="space-y-12 text-center">
                                    <select value={viewDate.getFullYear()} onChange={(e) => setViewDate(new Date(parseInt(e.target.value), viewDate.getMonth(), 1))} className="w-full bg-white/5 border border-white/10 rounded-[2.5rem] p-10 text-5xl text-white font-black appearance-none outline-none focus:ring-4 ring-cyan-400/20">
                                        {availableYears.map(y => <option key={y} value={y} className="bg-slate-950" key={y}>{y}</option>)}
                                    </select>
                                    <div className="grid grid-cols-4 gap-4">
                                        {Array.from({length: 12}).map((_, i) => (
                                            <button key={i} onClick={() => { setViewDate(new Date(viewDate.getFullYear(), i, 1)); setShowNavModal(false); }} className={`py-6 rounded-3xl text-2xl font-black transition-all ${viewDate.getMonth() === i ? 'bg-cyan-500 text-white shadow-2xl' : 'bg-white/5 text-slate-500 hover:bg-white/10'}`}>{i + 1}</button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>